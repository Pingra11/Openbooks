<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OpenBooks ‚Äî Administrator Dashboard</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="header-left">
      <img src="assets/logo.svg" class="logo" />
      <h1>Admin Console</h1>
    </div>
    <div class="header-right">
      <div id="adminChip" class="account-chip"></div>
    </div>
  </header>

  <main class="admin-dashboard">
    
    <!-- Top Summary Bar -->
    <div class="dashboard-summary">
      <div class="summary-stats">
        <div class="stat-card">
          <div class="stat-number" id="totalUsers">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="activeUsers">0</div>
          <div class="stat-label">Active Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="pendingRequests">0</div>
          <div class="stat-label">Pending Requests</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="suspendedUsers">0</div>
          <div class="stat-label">Suspended Users</div>
        </div>
      </div>
    </div>

    <!-- Main Dashboard Content -->
    <div class="dashboard-main">
      
      <!-- Left Column - User Management -->
      <div class="dashboard-column main-column">
        <section class="dashboard-section">
          <div class="section-header">
            <h2>User Management</h2>
            <div class="action-buttons">
              <button onclick="showCreateUserModal()">Create New User</button>
              <button onclick="showBulkActionsModal()">Bulk Actions</button>
            </div>
          </div>
          
          <div class="user-management-controls">
            <div class="search-filter-bar">
              <input type="text" id="userSearchInput" placeholder="Search users..." class="search-input">
              <select id="roleFilter" class="filter-select">
                <option value="">All Roles</option>
                <option value="administrator">Administrator</option>
                <option value="manager">Manager</option>
                <option value="accountant">Accountant</option>
              </select>
              <select id="statusFilter" class="filter-select">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
          </div>

          <div class="table-container">
            <table id="usersTable" class="modern-table">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Last Login</th>
                  <th>Created</th>
                  <th class="actions-column">Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Users will be loaded here -->
              </tbody>
            </table>
            <div id="emptyState" class="empty-state" style="display: none;">
              <p>No users found matching your criteria.</p>
            </div>
          </div>
          
          <div class="pagination-controls">
            <button id="prevPage" onclick="changePage(-1)" disabled>Previous</button>
            <span id="pageInfo">Page 1 of 1</span>
            <button id="nextPage" onclick="changePage(1)" disabled>Next</button>
          </div>
        </section>
      </div>

      <!-- Right Column - Secondary Functions -->
      <div class="dashboard-column sidebar-column">
        
        <!-- Pending Requests -->
        <section class="dashboard-section">
          <h3>Pending User Requests</h3>
          <div class="table-container">
            <table id="requestsTable" class="compact-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Role</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

        <!-- Quick Actions -->
        <section class="dashboard-section">
          <h3>Quick Actions</h3>
          <div class="quick-actions-grid">
            <button onclick="showUserReport()" class="quick-action-btn">
              <span class="action-icon">üìä</span>
              <span class="action-text">User Report</span>
            </button>
            <button onclick="showEmailTool()" class="quick-action-btn">
              <span class="action-icon">‚úâÔ∏è</span>
              <span class="action-text">Send Email</span>
            </button>
            <button onclick="showSystemSettings()" class="quick-action-btn">
              <span class="action-icon">‚öôÔ∏è</span>
              <span class="action-text">Settings</span>
            </button>
            <button onclick="exportData()" class="quick-action-btn">
              <span class="action-icon">üíæ</span>
              <span class="action-text">Export Data</span>
            </button>
          </div>
        </section>

        <!-- Recent Activity -->
        <section class="dashboard-section">
          <h3>Recent Activity</h3>
          <div id="recentActivity" class="activity-list"></div>
        </section>

        <!-- Additional Reports -->
        <section class="dashboard-section">
          <h3>Additional Reports</h3>
          <div class="report-links">
            <button onclick="showPasswordExpiryReport()" class="report-link">Password Expiry Report</button>
            <button onclick="showLoginReport()" class="report-link">Login Activity Report</button>
            <button onclick="showSecurityReport()" class="report-link">Security Report</button>
          </div>
        </section>

        <!-- System Actions -->
        <section class="dashboard-section">
          <div class="system-actions">
            <button id="signOut" class="sign-out-btn">Sign Out</button>
          </div>
        </section>

      </div>
    </div>
  </main>

  <!-- Modal Dialogs -->
  <!-- Create User Modal -->
  <div id="createUserModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('createUserModal')">&times;</span>
      <h2>Create New User</h2>
      <form id="createUserForm">
        <div class="form-grid">
          <div class="field-group">
            <label>First Name *</label>
            <input id="newFirstName" required />
          </div>
          <div class="field-group">
            <label>Last Name *</label>
            <input id="newLastName" required />
          </div>
          <div class="field-group">
            <label>Email *</label>
            <input id="newEmail" type="email" required />
          </div>
          <div class="field-group">
            <label>Role *</label>
            <select id="newRole" required>
              <option value="">Select Role...</option>
              <option value="administrator">Administrator</option>
              <option value="manager">Manager</option>
              <option value="accountant">Regular User (Accountant)</option>
            </select>
          </div>
          <div class="field-group">
            <label>Phone</label>
            <input id="newPhone" type="tel" />
          </div>
          <div class="field-group">
            <label>Department</label>
            <input id="newDepartment" />
          </div>
        </div>
        <div class="field-group">
          <label>Address</label>
          <textarea id="newAddress" rows="2"></textarea>
        </div>
        <div class="field-group">
          <label>
            <input type="checkbox" id="sendWelcomeEmail" checked />
            Send welcome email with login credentials
          </label>
        </div>
        <button type="submit">Create User</button>
        <button type="button" onclick="closeModal('createUserModal')" class="secondary">Cancel</button>
        <div id="createUserResult"></div>
      </form>
    </div>
  </div>

  <!-- Email Tool Modal -->
  <div id="emailModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('emailModal')">&times;</span>
      <h2>Send Email</h2>
      <form id="emailForm">
        <div class="field-group">
          <label>Select Recipients</label>
          <select id="emailRecipients" multiple style="height: 120px;">
            <!-- Options loaded dynamically -->
          </select>
          <small>Hold Ctrl/Cmd to select multiple users</small>
        </div>
        <div class="field-group">
          <label>Subject *</label>
          <input id="emailSubject" required />
        </div>
        <div class="field-group">
          <label>Message *</label>
          <textarea id="emailMessage" rows="6" required></textarea>
        </div>
        <button type="submit">Send Email</button>
        <button type="button" onclick="closeModal('emailModal')" class="secondary">Cancel</button>
        <div id="emailResult"></div>
      </form>
    </div>
  </div>

  <!-- User Report Modal -->
  <div id="userReportModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('userReportModal')">&times;</span>
      <h2>User Report</h2>
      <div id="userReportContent"></div>
    </div>
  </div>

  <!-- Password Expiry Report Modal -->
  <div id="passwordExpiryModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('passwordExpiryModal')">&times;</span>
      <h2>Password Expiry Report</h2>
      <div id="passwordExpiryContent"></div>
    </div>
  </div>

  <!-- Login Report Modal -->
  <div id="loginReportModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('loginReportModal')">&times;</span>
      <h2>Login Activity Report</h2>
      <div id="loginReportContent"></div>
    </div>
  </div>

  <!-- Security Report Modal -->
  <div id="securityReportModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('securityReportModal')">&times;</span>
      <h2>Security Report</h2>
      <div id="securityReportContent"></div>
    </div>
  </div>

  <script type="module" src="js/firebaseConfig.js"></script>
  <script type="module" src="js/ui.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/admin.js"></script>
</body>
</html>